import React, { useState, useEffect } from 'react';
import { initializeApp } from 'firebase/app';
import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from 'firebase/auth';
import { getFirestore } from 'firebase/firestore';

// Ensure these global variables are defined in the Canvas environment
const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

// Main App component
const App = () => {
    const [currentPage, setCurrentPage] = useState('home');
    const [firebaseApp, setFirebaseApp] = useState(null);
    const [auth, setAuth] = useState(null);
    const [db, setDb] = useState(null);
    const [userId, setUserId] = useState(null);
    const [isAuthReady, setIsAuthReady] = useState(false);

    // Initialize Firebase and set up auth listener
    useEffect(() => {
        try {
            const app = initializeApp(firebaseConfig);
            const authInstance = getAuth(app);
            const dbInstance = getFirestore(app);

            setFirebaseApp(app);
            setAuth(authInstance);
            setDb(dbInstance);

            // Sign in with custom token or anonymously
            const signIn = async () => {
                try {
                    if (initialAuthToken) {
                        await signInWithCustomToken(authInstance, initialAuthToken);
                    } else {
                        await signInAnonymously(authInstance);
                    }
                } catch (error) {
                    console.error("Firebase authentication error:", error);
                }
            };

            // Listen for auth state changes
            const unsubscribe = onAuthStateChanged(authInstance, (user) => {
                if (user) {
                    setUserId(user.uid);
                } else {
                    setUserId(crypto.randomUUID()); // Use a random ID if not authenticated
                }
                setIsAuthReady(true);
            });

            signIn(); // Trigger sign-in

            // Cleanup subscription on unmount
            return () => unsubscribe();
        } catch (error) {
            console.error("Failed to initialize Firebase:", error);
        }
    }, []); // Empty dependency array means this runs once on mount

    // Page content components
    const HomePage = () => (
        <div className="p-12 md:p-16 bg-white rounded-xl shadow-xl mb-8 border border-gray-100">
            <h2 className="text-4xl lg:text-5xl font-extrabold text-blue-800 mb-6 text-center leading-tight">Empowering Students Through Mindfulness: A Path to Resilience</h2>
            <p className="text-gray-700 leading-relaxed text-lg mb-6">
                My name is [Your Name], and I am a dedicated volunteer with <strong className="text-blue-700">Youth Global Citizen (YGC)</strong>, a youth-led program passionately dedicated to raising funds for impactful non-profits. We are working hand-in-hand with one such incredible non-profit, the <strong className="text-blue-700">Promise Council</strong>. We are a group of passionate students, just like those we aim to help, embarking on a vital fundraising initiative to equip middle school students in our community with essential life skills.
            </p>
            <p className="text-gray-700 leading-relaxed text-lg mb-6">
                The Promise Council strives to help students focus on building strong, positive relationships with their teachers and peers. Their core approach involves mentoring students through regular meetings, complemented by the use of specially designed journals in-between these sessions.
            </p>
            <p className="text-gray-700 leading-relaxed text-lg mb-6">
                Our ambitious, yet achievable, goal is to raise <strong className="text-yellow-600">$1,000</strong>. This will allow us to provide <strong className="text-blue-700">Mindfulness Notebooks</strong> to every middle schooler who needs one. These aren't just ordinary notebooks; they are carefully crafted resources, brimming with practical exercises and proven techniques designed to help students master stress, sharpen their focus, and cultivate robust emotional intelligence. These qualities empower youth by building self-esteem, mindfulness, and gratitude.
            </p>
            <p className="text-gray-700 leading-relaxed text-lg mb-6">
                By fostering these crucial qualities, students are able to create better connections with teachers and peers, contribute to a more welcoming and inclusive learning environment, and unlock better opportunities in the future, ultimately leading to greater success in all aspects of their lives.
            </p>
            <p className="text-gray-700 leading-relaxed text-lg mb-6">
                What makes your contribution truly extraordinary is YGC's unwavering commitment to <strong className="text-yellow-600">match every single dollar we raise</strong>. This means your generous donation isn't just a contribution; it's an investment that will be doubled, creating an even greater, more profound impact on the lives of these young individuals. Imagine the collective strength of your support multiplied!
            </p>
            <p className="text-gray-700 leading-relaxed text-lg">
                By choosing to sponsor this crucial initiative, your business can play a pivotal and highly visible role in fostering the mental resilience, academic achievement, and overall well-being of the next generation. This is an unparalleled opportunity for your organization to demonstrate its deep commitment to community development and to directly empower the youth who will shape our future. Join us in making a real, lasting difference. <strong className="text-blue-700">All donations will be directly used to purchase and supply these essential journals.</strong>
            </p>
        </div>
    );

    const AboutUsPage = () => (
        <div className="p-12 md:p-16 bg-white rounded-xl shadow-xl mb-8 border border-gray-100">
            <h2 className="text-4xl lg:text-5xl font-extrabold text-blue-800 mb-6 text-center leading-tight">Our Mission: Cultivating Resilience in Young Minds</h2>
            <p className="text-gray-700 leading-relaxed text-lg mb-6">
                The **Youth Global Citizen (YGC)** is a dynamic, student-led program driven by the belief that every young person deserves the opportunity to thrive. We are passionately dedicated to fostering holistic development, providing practical tools, and creating supportive environments where students can build resilience, enhance their well-being, and unlock their full potential. YGC achieves this by raising funds for various impactful non-profit organizations, amplifying their reach and mission.
            </p>
            <p className="text-gray-700 leading-relaxed text-lg mb-6">
                Our collaborative strength comes from our proud partnership with the **Promise Council**, a highly respected community-driven initiative. The Promise Council is relentlessly committed to ensuring equitable opportunities for all children, working tirelessly to bridge resource gaps and advocate for programs that elevate educational outcomes and personal growth. Their primary focus is on helping students develop strong, positive relationships with their teachers and peers. They achieve this through a structured mentoring program, involving regular meetings and the strategic use of specially designed journals in-between sessions.
            </p>
            <p className="text-gray-700 leading-relaxed text-lg">
                The provision of Mindfulness Notebooks is a cornerstone of our shared mission. These notebooks are not merely a product; they represent our unwavering commitment to equipping middle school students with essential coping mechanisms for managing stress and anxiety, significantly improving their focus, and cultivating profound emotional intelligence during a critical developmental stage. These journals specifically empower youth by building self-esteem, fostering mindfulness, and cultivating gratitude. By developing these vital qualities, students are better equipped to create stronger connections with teachers and peers, contribute to a more welcoming learning environment, and seize better opportunities in the future, ultimately leading to greater academic and personal success. We are united in our vision for a future where every student possesses the mental fortitude, self-awareness, and unwavering support needed to achieve their highest aspirations.
            </p>
        </div>
    );

    const HowToDonatePage = () => (
        <div className="p-12 md:p-16 bg-white rounded-xl shadow-xl mb-8 border border-gray-100">
            <h2 className="text-4xl lg:text-5xl font-extrabold text-blue-800 mb-6 text-center leading-tight">Your Impact: How Every Contribution Transforms Lives</h2>
            <p className="text-gray-700 leading-relaxed text-lg mb-6">
                Your support is not just a donation; it's a direct investment in the mental well-being and future success of middle school students. Every contribution, no matter the size, brings us significantly closer to empowering young minds with the essential tools they need to navigate life's challenges. <strong className="text-blue-700">All funds raised will be directly used to purchase and supply the Mindfulness Notebooks.</strong>
            </p>
            <h3 className="text-3xl font-bold text-gray-800 mb-4">Seamless Online Donation via GoFundMe:</h3>
            <p className="text-gray-700 leading-relaxed text-lg mb-6">
                The quickest and most impactful way to contribute is through our secure GoFundMe page. Remember, your generosity here will be <strong className="text-yellow-600">doubled instantly</strong> by the Youth Global Citizen's matching program! This means your $50 donation becomes $100, directly benefiting more students.
            </p>
            <div className="text-center mb-8">
                <a
                    href="[Insert GoFundMe Link Here]"
                    target="_blank"
                    rel="noopener noreferrer"
                    className="inline-block bg-gradient-to-r from-blue-600 to-yellow-600 hover:from-blue-700 hover:to-yellow-700 text-white font-bold py-4 px-8 rounded-md transition duration-300 ease-in-out transform hover:scale-105 shadow-xl hover:shadow-2xl"
                >
                    Donate on GoFundMe and Double Your Impact
                </a>
            </div>
            <h3 className="text-3xl font-bold text-gray-800 mb-4">Alternative Ways to Contribute:</h3>
            <ul className="list-disc list-inside text-gray-700 leading-relaxed text-lg mb-6 space-y-2">
                <li>
                    <strong className="text-blue-700">Direct Bank Transfer:</strong> For substantial contributions or corporate sponsorships, please contact us directly. We will provide secure bank transfer details to facilitate your impactful gift.
                </li>
                <li>
                    <strong className="text-blue-700">Check by Mail:</strong> You can also mail a check, made payable to "Youth Global Citizen," to ensure your support reaches us directly:
                    <br />
                    <span className="block mt-2">[Your Organization's Address Here]</span>
                </li>
                <li>
                    <strong className="text-blue-700">In-Kind Donations:</strong> Do you have resources, expertise, or services that could significantly benefit our cause? We welcome discussions about potential in-kind contributions that align with our mission. Please reach out!
                </li>
            </ul>
            <p className="text-gray-700 leading-relaxed text-lg">
                Every dollar you contribute is a step towards a more mindful, resilient generation. Thank you for your profound generosity and unwavering commitment to the future of our youth. Your support truly makes a difference.
            </p>
        </div>
    );

    const ContactUsPage = () => (
        <div className="p-12 md:p-16 bg-white rounded-xl shadow-xl mb-8 border border-gray-100">
            <h2 className="text-4xl lg:text-5xl font-extrabold text-blue-800 mb-6 text-center leading-tight">Connect With Us: Let's Build a Brighter Future Together</h2>
            <p className="text-gray-700 leading-relaxed text-lg mb-6">
                We are eager to connect with you and discuss how your partnership can profoundly impact the lives of middle school students. Whether you have questions, wish to explore a collaboration, or need more detailed information about our initiative, please do not hesitate to reach out. Your interest is invaluable to us.
            </p>
            <div className="space-y-6">
                <div>
                    <h3 className="text-3xl font-bold text-gray-800 mb-2">Email Us Directly:</h3>
                    <p className="text-gray-700 text-lg">
                        <a href="mailto:[Your Email Address]" className="text-blue-600 hover:underline">
                            [Your Email Address]
                        </a>
                    </p>
                </div>
                <div>
                    <h3 className="text-3xl font-bold text-gray-800 mb-2">Call Us:</h3>
                    <p className="text-gray-700 text-lg">[Your Phone Number (Optional)]</p>
                </div>
                <div>
                    <h3 className="text-3xl font-bold text-gray-800 mb-2">Our Mailing Address:</h3>
                    <p className="text-gray-700 text-lg">
                        Youth Global Citizen (YGC)
                        <br />
                        [Your Organization's Address Here]
                    </p>
                </div>
                <p className="text-gray-700 leading-relaxed text-lg pt-4">
                    We eagerly anticipate connecting with you and collaborating to champion the mental well-being and academic success of middle school students. Your engagement is key to our shared success.
                </p>
            </div>
        </div>
    );

    const renderPage = () => {
        switch (currentPage) {
            case 'home':
                return <HomePage />;
            case 'about':
                return <AboutUsPage />;
            case 'donate':
                return <HowToDonatePage />;
            case 'contact':
                return <ContactUsPage />;
            default:
                return <HomePage />;
        }
    };

    return (
        <div className="min-h-screen bg-blue-50 font-sans antialiased flex flex-col items-center py-12 px-4 sm:px-6 lg:px-8">
            {/* Tailwind CSS CDN */}
            <script src="https://cdn.tailwindcss.com"></script>
            {/* Inter font */}
            <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />
            <style>
                {`
                body {
                    font-family: 'Inter', sans-serif;
                }
                /* Custom styles for rounded corners and shadows on main containers */
                .rounded-xl {
                    border-radius: 0.75rem; /* More rounded */
                }
                .shadow-xl {
                    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
                }
                .shadow-2xl {
                    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
                }
                `}
            </style>

            <header className="w-full max-w-5xl bg-white rounded-xl shadow-xl p-8 mb-10 flex flex-col sm:flex-row justify-between items-center border border-gray-100 sticky top-0 z-50">
                <h1 className="text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-yellow-600 mb-6 sm:mb-0 text-center sm:text-left">
                    Mindfulness for Middle Schoolers
                </h1>
                <nav className="flex flex-wrap justify-center gap-3 sm:gap-4">
                    <button
                        onClick={() => setCurrentPage('home')}
                        className={`py-3 px-6 rounded-md font-semibold text-lg transition duration-300 ease-in-out transform hover:scale-105 ${
                            currentPage === 'home' ? 'bg-gradient-to-r from-blue-600 to-yellow-600 text-white shadow-lg' : 'text-blue-800 hover:bg-blue-50 hover:text-blue-900'
                        }`}
                    >
                        Home
                    </button>
                    <button
                        onClick={() => setCurrentPage('about')}
                        className={`py-3 px-6 rounded-md font-semibold text-lg transition duration-300 ease-in-out transform hover:scale-105 ${
                            currentPage === 'about' ? 'bg-gradient-to-r from-blue-600 to-yellow-600 text-white shadow-lg' : 'text-blue-800 hover:bg-blue-50 hover:text-blue-900'
                        }`}
                    >
                        About Us
                    </button>
                    <button
                        onClick={() => setCurrentPage('donate')}
                        className={`py-3 px-6 rounded-md font-semibold text-lg transition duration-300 ease-in-out transform hover:scale-105 ${
                            currentPage === 'donate' ? 'bg-gradient-to-r from-blue-600 to-yellow-600 text-white shadow-lg' : 'text-blue-800 hover:bg-blue-50 hover:text-blue-900'
                        }`}
                    >
                        How to Donate
                    </button>
                    <button
                        onClick={() => setCurrentPage('contact')}
                        className={`py-3 px-6 rounded-md font-semibold text-lg transition duration-300 ease-in-out transform hover:scale-105 ${
                            currentPage === 'contact' ? 'bg-gradient-to-r from-blue-600 to-yellow-600 text-white shadow-lg' : 'text-blue-800 hover:bg-blue-50 hover:text-blue-900'
                        }`}
                    >
                        Contact Us
                    </button>
                </nav>
            </header>

            <main className="w-full max-w-5xl bg-white rounded-xl shadow-xl p-12 md:p-16 border border-gray-100">
                {renderPage()}
            </main>

            <footer className="w-full max-w-5xl text-center text-gray-600 mt-10 py-6 border-t border-gray-200">
                <p className="text-md">&copy; {new Date().getFullYear()} Youth Global Citizen. All rights reserved.</p>
                {isAuthReady && userId && (
                    <p className="text-sm mt-2 text-gray-500">User ID: {userId}</p>
                )}
            </footer>
        </div>
    );
};

export default App;
